# nginx-反向代理

## 1.nginx的正向代理

### 1.什么是正向代理

Nginx 不仅可以做反向代理，实现负载均衡。还能用作正向代理来进行上网等功能。
正向代理：如果把局域网外的 Internet 想象成一个巨大的资源库，则局域网中的客户端要访问 Internet，则需要通过代理服务器来访问，这种代理服务就称为正向代理。（在客户端配置代理服务器）

![image-20201125150140565](nginx.assets/image-20201125150140565.png)

### 2.正向代理的作用

（1）访问原来无法访问的资源，如google

（2） 可以做缓存，加速访问资源

（3）对客户端访问授权，上网进行认证

（4）代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息

## 2.nginx的反向代理

### 1.什么是反向代理

反向代理，其实客户端对代理是无感知的，因为客户端不需要任何配置就可以访问，我们只需要将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，在返回给客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器地址，隐藏了真实服务器 IP 地址。

![img](nginx.assets/ZR6V2COILQH}]5@ZW[8Y}QS.png)

### 2.反向代理的作用

（1）保证内网的安全，阻止web攻击，大型网站，通常将反向代理作为公网访问地址，Web服务器是内网
（2）负载均衡，通过反向代理服务器来优化网站的负载

## 3.正向代理和反向代理的区别

正向代理即是客户端代理, 代理客户端, 服务端不知道实际发起请求的客户端.

反向代理即是服务端代理, 代理服务端, 客户端不知道实际提供服务的服务端

## 4.反向代理实例（配置nginx)

实例：使用 nginx 反向代理，根据访问路径跳转到不同端口的服务中nginx 监听端口为 9001
访问 http://124.70.88.90:9001/edu/ 直接跳转到 127.0.0.1:8080
访问 http://124.70.88.90:9001/vod/ 直接跳转到 127.0.0.1:8081

### 1.配置两个tomcat

（1）首先将创建两个文件夹，命名为8080和8081，将tomcat压缩包装入并解压。

（2）进入8080tomcat启动这个服务器（默认端口为8080，我们不用改动任何配置）

​		 进入8081tomcat文件夹修改配置文件

```
cd usr/src/tomcat8081/
cd apache-tomcat-7.0.70
vi conf  //进入配置文件进行更改
```

![图片1](nginx.assets/图片1.png)



### ![图片2](nginx.assets/图片2.png)

![图片3](nginx.assets/图片3.png)

### 2.创建两个文件夹测试一下两个端口

（1）在这个路径下分别创建edu文件夹和vod文件夹，并在里面创建一个html文件

![3](nginx.assets/3.png)

![4](nginx.assets/4.png)

(2)分别启动这两tomcat

进入到放置这两个romcat的文件中并启动：

```
cd usr/src/tomcat8080/bin/
./startup.sh  #启动tomcat8080
cd usr/src/tomcat8081/bin/
./startup.sh  #启动tomcat8081
```

（3）输入网址测试一下

![8081](nginx.assets/8081.png)

![{D0CYY}XDJYRESY78OR970I](nginx.assets/{D0CYY}XDJYRESY78OR970I.png)

测试成功，下面开始配置nginx

### 3.配置nginx

（1)进入nginx配置文件进行配置

​	找到conf文件用vi nginx.conf命令进入文件进行修改

```
vi nginx.conf

server{
	listen 9001;#监听9001端口号
	server_name 124.70.88.90 #服务器地址
	location ~ /edu/{
		proxy_pass http://127.0.0.1:8080 #后缀是edu请求8080端口
	}
	location ~ /vod/{
		proxy_pass http://127.0.0.1:8081 #后缀是vod请求8081端口
	}
}
```

（2）配置完成后重启nginx即可

进入nginx的执行文件目录

```
./nginx #重启nginx
```

###  4.最终测试结果

![5](nginx.assets/5.png)

![6](nginx.assets/6.png)

